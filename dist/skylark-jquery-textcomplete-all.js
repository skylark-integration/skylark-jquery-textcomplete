/**
 * skylark-jquery-textcomplete - A version of jquery-textcomplete.js that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-jquery-textcomplete/
 * @license MIT
 */
!function(e,t){var n=t.define,i=t.require,r="function"==typeof n&&n.amd,o=!r&&"undefined"!=typeof exports;if(!r&&!n){var a={};n=t.define=function(e,t,n){"function"==typeof n?(a[e]={factory:n,deps:t.map(function(t){return function(e,t){if("."!==e[0])return e;var n=t.split("/"),i=e.split("/");n.pop();for(var r=0;r<i.length;r++)"."!=i[r]&&(".."==i[r]?n.pop():n.push(i[r]));return n.join("/")}(t,e)}),resolved:!1,exports:null},i(e)):a[e]={factory:null,resolved:!0,exports:n}},i=t.require=function(e){if(!a.hasOwnProperty(e))throw new Error("Module "+e+" has not been defined");var n=a[e];if(!n.resolved){var r=[];n.deps.forEach(function(e){r.push(i(e))}),n.exports=n.factory.apply(t,r)||null,n.resolved=!0}return n.exports}}if(!n)throw new Error("The module utility (ex: requirejs or skylark-utils) is not loaded!");if(function(e,t){defin(["skylark-jquery"],function(e){"use strict";var t=1;e.fn.textcomplete=function(n,i){var r=Array.prototype.slice.call(arguments);return this.each(function(){var o=e(this),a=o.data("textComplete");if(a||(i||(i={}),i._oid=t++,a=new e.fn.textcomplete.Completer(this,i),o.data("textComplete",a)),"string"==typeof n){if(!a)return;r.shift(),a[n].apply(a,r),"destroy"===n&&o.removeData("textComplete")}else e.each(n,function(t){e.each(["header","footer","placement","maxCount"],function(e){var n;t[e]&&(a.option[e]=t[e],n=e+"as a strategy param is deprecated. Use option.",console.warn&&console.warn(n),delete t[e])})}),a.register(e.fn.textcomplete.Strategy.parse(n,{el:this,$el:o}))})}}),e("skylark-jquery-textcomplete/textcomplete",function(){}),defin(["skylark-jquery","./textcomplete"],function(e){"use strict";var t=function(e){var t={};return function(n,i){t[n]?i(t[n]):e.call(this,n,function(e){t[n]=(t[n]||[]).concat(e),i.apply(null,arguments)})}};function n(n){e.extend(this,n),this.cache&&(this.search=t(this.search))}n.parse=function(t,i){return e.map(t,function(e){var t=new n(e);return t.el=i.el,t.$el=i.$el,t})},e.extend(n.prototype,{match:null,replace:null,search:null,id:null,cache:!1,context:function(){return!0},index:2,template:function(e){return e},idProperty:null}),e.fn.textcomplete.Strategy=n}),e("skylark-jquery-textcomplete/strategy",function(){}),defin(["skylark-jquery","./textcomplete","./dropdown"],function(e){"use strict";var t,n,i,r=0,o=[];function a(t,n){if(this.$el=e(t),this.id="textcomplete"+r++,this.strategies=[],this.views=[],this.option=e.extend({},a.defaults,n),!(this.$el.is("input[type=text]")||this.$el.is("input[type=search]")||this.$el.is("textarea")||t.isContentEditable||"true"==t.contentEditable))throw new Error("textcomplete must be called on a Textarea or a ContentEditable.");if(t===t.ownerDocument.activeElement)this.initialize();else{var i=this;this.$el.one("focus."+this.id,function(){i.initialize()}),this.option.adapter&&"CKEditor"!=this.option.adapter||"undefined"==typeof CKEDITOR||!this.$el.is("textarea")||CKEDITOR.on("instanceReady",function(t){-1==e.inArray(t.editor.id,o)&&(o.push(t.editor.id),t.editor.on("focus",function(n){i.$el=e(t.editor.editable().$),i.option.adapter||(i.option.adapter=e.fn.textcomplete.CKEditor),i.option.ckeditor_instance=t.editor,i.initialize()}))})}}a.defaults={appendTo:"body",className:"",dropdownClassName:"dropdown-menu textcomplete-dropdown",maxCount:10,zIndex:"100",rightEdgeOffset:30},e.extend(a.prototype,{id:null,option:null,strategies:null,adapter:null,dropdown:null,$el:null,$iframe:null,initialize:function(){var t,n,i=this.$el.get(0);if(this.$el.prop("ownerDocument")!==document&&window.frames.length)for(var r=0;r<window.frames.length;r++)if(this.$el.prop("ownerDocument")===window.frames[r].document){this.$iframe=e(window.frames[r].frameElement);break}this.dropdown=new e.fn.textcomplete.Dropdown(i,this,this.option),this.option.adapter?t=this.option.adapter:(n=this.$el.is("textarea")||this.$el.is("input[type=text]")||this.$el.is("input[type=search]")?"number"==typeof i.selectionEnd?"Textarea":"IETextarea":"ContentEditable",t=e.fn.textcomplete[n]),this.adapter=new t(i,this,this.option)},destroy:function(){this.$el.off("."+this.id),this.adapter&&this.adapter.destroy(),this.dropdown&&this.dropdown.destroy(),this.$el=this.adapter=this.dropdown=null},deactivate:function(){this.dropdown&&this.dropdown.deactivate()},trigger:function(e,t){this.dropdown||this.initialize(),null!=e||(e=this.adapter.getTextFromHeadToCaret());var n=this._extractSearchQuery(e);if(n.length){var i=n[1];if(t&&this._term===i&&""!==i)return;this._term=i,this._search.apply(this,n)}else this._term=null,this.dropdown.deactivate()},fire:function(e){var t=Array.prototype.slice.call(arguments,1);return this.$el.trigger(e,t),this},register:function(e){Array.prototype.push.apply(this.strategies,e)},select:function(e,t,n){this._term=null,this.adapter.select(e,t,n),this.fire("change").fire("textComplete:select",e,t),this.adapter.focus()},_clearAtNext:!0,_term:null,_extractSearchQuery:function(t){for(var n=0;n<this.strategies.length;n++){var i=this.strategies[n],r=i.context(t);if(r||""===r){var o=e.isFunction(i.match)?i.match(t):i.match;s=r,"[object String]"===Object.prototype.toString.call(s)&&(t=r);var a=t.match(o);if(a)return[i,a[i.index],a]}}var s;return[]},_search:(t=function(e,t,n,i){var r=this;t.search(n,function(i,o){r.dropdown.shown||r.dropdown.activate(),r._clearAtNext&&(r.dropdown.clear(),r._clearAtNext=!1),r.dropdown.setPosition(r.adapter.getCaretPosition()),r.dropdown.render(r._zip(i,t,n)),o||(e(),r._clearAtNext=!0)},i)},function(){var e=Array.prototype.slice.call(arguments);if(n)i=e;else{n=!0;var r=this;e.unshift(function e(){if(i){var o=i;i=void 0,o.unshift(e),t.apply(r,o)}else n=!1}),t.apply(this,e)}}),_zip:function(t,n,i){return e.map(t,function(e){return{value:e,strategy:n,term:i}})}}),e.fn.textcomplete.Completer=a}),e("skylark-jquery-textcomplete/completer",function(){}),defin(["skylark-jquery","./textcomplete"],function(e){"use strict";function t(e,t,n){this.initialize(e,t,n)}e.extend(t.prototype,e.fn.textcomplete.Adapter.prototype,{select:function(t,n,i){var r=this.getTextFromHeadToCaret(),o=this.el.ownerDocument.getSelection(),a=o.getRangeAt(0),s=a.cloneRange();s.selectNodeContents(a.startContainer);var l,c=s.toString(),p=c.substring(a.startOffset),u=n.replace(t,i);if(void 0!==u){e.isArray(u)&&(p=u[1]+p,u=u[0]),l=e.isFunction(n.match)?n.match(r):n.match,r=r.replace(l,u).replace(/ $/,"&nbsp"),a.selectNodeContents(a.startContainer),a.deleteContents();var d=this.el.ownerDocument.createElement("div");d.innerHTML=r;var h=this.el.ownerDocument.createElement("div");h.innerHTML=p;for(var f,m,y=this.el.ownerDocument.createDocumentFragment();f=d.firstChild;)m=y.appendChild(f);for(;f=h.firstChild;)y.appendChild(f);a.insertNode(y),a.setStartAfter(m),a.collapse(!0),o.removeAllRanges(),o.addRange(a)}},_getCaretRelativePosition:function(){var t=this.el.ownerDocument.getSelection().getRangeAt(0).cloneRange(),n=t.endContainer.parentNode,i=this.el.ownerDocument.createElement("span");t.insertNode(i),t.selectNodeContents(i),t.deleteContents(),setTimeout(function(){n.normalize()},0);var r=e(i),o=r.offset();if(o.left-=this.$el.offset().left,o.top+=r.height()-this.$el.offset().top,o.lineHeight=r.height(),this.completer.$iframe){var a=this.completer.$iframe.offset();o.top+=a.top,o.left+=a.left,o.top-=e(this.completer.$iframe[0].contentWindow.document).scrollTop()}return r.remove(),o},getTextFromHeadToCaret:function(){var e=this.el.ownerDocument.getSelection().getRangeAt(0),t=e.cloneRange();return t.selectNodeContents(e.startContainer),t.toString().substring(0,e.startOffset)}}),e.fn.textcomplete.ContentEditable=t}),e("skylark-jquery-textcomplete/content_editable",function(){}),defin(["skylark-jquery","./textcomplete","./adapter","./vendor/textarea_caret"],function(e){"use strict";function t(e,t,n){this.initialize(e,t,n)}e.extend(t.prototype,e.fn.textcomplete.Adapter.prototype,{select:function(t,n,i){var r,o=this.getTextFromHeadToCaret(),a=this.el.value.substring(this.el.selectionEnd),s=n.replace(t,i);void 0!==s&&(e.isArray(s)&&(a=s[1]+a,s=s[0]),r=e.isFunction(n.match)?n.match(o):n.match,o=o.replace(r,s),this.$el.val(o+a),this.el.selectionStart=this.el.selectionEnd=o.length)},getTextFromHeadToCaret:function(){return this.el.value.substring(0,this.el.selectionEnd)},_getCaretRelativePosition:function(){var t=e.fn.textcomplete.getCaretCoordinates(this.el,this.el.selectionStart);return{top:t.top+this._calculateLineHeight()-this.$el.scrollTop(),left:t.left-this.$el.scrollLeft(),lineHeight:this._calculateLineHeight()}},_calculateLineHeight:function(){var e=parseInt(this.$el.css("line-height"),10);if(isNaN(e)){var t=this.el.parentNode,n=document.createElement(this.el.nodeName),i=this.el.style;n.setAttribute("style","margin:0px;padding:0px;font-family:"+i.fontFamily+";font-size:"+i.fontSize),n.innerHTML="test",t.appendChild(n),e=n.clientHeight,t.removeChild(n)}return e}}),e.fn.textcomplete.Textarea=t}),e("skylark-jquery-textcomplete/textarea",function(){}),e("skylark-jquery-textcomplete/main",["./textcomplete","./strategy","./completer","./content_editable","./textarea"],function(){}),e("skylark-jquery-textcomplete",["skylark-jquery-textcomplete/main"],function(e){return e});try{t("skylark-jquery-textcomplete")}catch(e){console.error("please use skylark-requirejs")}}(n,i),!r){var s=i("skylark-langx/skylark");o?module.exports=s:t.skylarkjs=s}}(0,this);
//# sourceMappingURL=sourcemaps/skylark-jquery-textcomplete-all.js.map
