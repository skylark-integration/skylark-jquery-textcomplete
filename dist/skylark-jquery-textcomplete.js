/**
 * skylark-jquery-textcomplete - A version of jquery-textcomplete.js that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-jquery-textcomplete/
 * @license MIT
 */
!function(t,e){var n=e.define,i=e.require,r="function"==typeof n&&n.amd,o=!r&&"undefined"!=typeof exports;if(!r&&!n){var a={};n=e.define=function(t,e,n){"function"==typeof n?(a[t]={factory:n,deps:e.map(function(e){return function(t,e){if("."!==t[0])return t;var n=e.split("/"),i=t.split("/");n.pop();for(var r=0;r<i.length;r++)"."!=i[r]&&(".."==i[r]?n.pop():n.push(i[r]));return n.join("/")}(e,t)}),resolved:!1,exports:null},i(t)):a[t]={factory:null,resolved:!0,exports:n}},i=e.require=function(t){if(!a.hasOwnProperty(t))throw new Error("Module "+t+" has not been defined");var n=a[t];if(!n.resolved){var r=[];n.deps.forEach(function(t){r.push(i(t))}),n.exports=n.factory.apply(e,r)||null,n.resolved=!0}return n.exports}}if(!n)throw new Error("The module utility (ex: requirejs or skylark-utils) is not loaded!");if(function(t,e){defin(["skylark-jquery"],function(t){"use strict";var e=1;t.fn.textcomplete=function(n,i){var r=Array.prototype.slice.call(arguments);return this.each(function(){var o=t(this),a=o.data("textComplete");if(a||(i||(i={}),i._oid=e++,a=new t.fn.textcomplete.Completer(this,i),o.data("textComplete",a)),"string"==typeof n){if(!a)return;r.shift(),a[n].apply(a,r),"destroy"===n&&o.removeData("textComplete")}else t.each(n,function(e){t.each(["header","footer","placement","maxCount"],function(t){var n;e[t]&&(a.option[t]=e[t],n=t+"as a strategy param is deprecated. Use option.",console.warn&&console.warn(n),delete e[t])})}),a.register(t.fn.textcomplete.Strategy.parse(n,{el:this,$el:o}))})}}),t("skylark-jquery-textcomplete/textcomplete",function(){}),defin(["skylark-jquery","./textcomplete"],function(t){"use strict";var e=function(t){var e={};return function(n,i){e[n]?i(e[n]):t.call(this,n,function(t){e[n]=(e[n]||[]).concat(t),i.apply(null,arguments)})}};function n(n){t.extend(this,n),this.cache&&(this.search=e(this.search))}n.parse=function(e,i){return t.map(e,function(t){var e=new n(t);return e.el=i.el,e.$el=i.$el,e})},t.extend(n.prototype,{match:null,replace:null,search:null,id:null,cache:!1,context:function(){return!0},index:2,template:function(t){return t},idProperty:null}),t.fn.textcomplete.Strategy=n}),t("skylark-jquery-textcomplete/strategy",function(){}),defin(["skylark-jquery","./textcomplete","./dropdown"],function(t){"use strict";var e,n,i,r=0,o=[];function a(e,n){if(this.$el=t(e),this.id="textcomplete"+r++,this.strategies=[],this.views=[],this.option=t.extend({},a.defaults,n),!(this.$el.is("input[type=text]")||this.$el.is("input[type=search]")||this.$el.is("textarea")||e.isContentEditable||"true"==e.contentEditable))throw new Error("textcomplete must be called on a Textarea or a ContentEditable.");if(e===e.ownerDocument.activeElement)this.initialize();else{var i=this;this.$el.one("focus."+this.id,function(){i.initialize()}),this.option.adapter&&"CKEditor"!=this.option.adapter||"undefined"==typeof CKEDITOR||!this.$el.is("textarea")||CKEDITOR.on("instanceReady",function(e){-1==t.inArray(e.editor.id,o)&&(o.push(e.editor.id),e.editor.on("focus",function(n){i.$el=t(e.editor.editable().$),i.option.adapter||(i.option.adapter=t.fn.textcomplete.CKEditor),i.option.ckeditor_instance=e.editor,i.initialize()}))})}}a.defaults={appendTo:"body",className:"",dropdownClassName:"dropdown-menu textcomplete-dropdown",maxCount:10,zIndex:"100",rightEdgeOffset:30},t.extend(a.prototype,{id:null,option:null,strategies:null,adapter:null,dropdown:null,$el:null,$iframe:null,initialize:function(){var e,n,i=this.$el.get(0);if(this.$el.prop("ownerDocument")!==document&&window.frames.length)for(var r=0;r<window.frames.length;r++)if(this.$el.prop("ownerDocument")===window.frames[r].document){this.$iframe=t(window.frames[r].frameElement);break}this.dropdown=new t.fn.textcomplete.Dropdown(i,this,this.option),this.option.adapter?e=this.option.adapter:(n=this.$el.is("textarea")||this.$el.is("input[type=text]")||this.$el.is("input[type=search]")?"number"==typeof i.selectionEnd?"Textarea":"IETextarea":"ContentEditable",e=t.fn.textcomplete[n]),this.adapter=new e(i,this,this.option)},destroy:function(){this.$el.off("."+this.id),this.adapter&&this.adapter.destroy(),this.dropdown&&this.dropdown.destroy(),this.$el=this.adapter=this.dropdown=null},deactivate:function(){this.dropdown&&this.dropdown.deactivate()},trigger:function(t,e){this.dropdown||this.initialize(),null!=t||(t=this.adapter.getTextFromHeadToCaret());var n=this._extractSearchQuery(t);if(n.length){var i=n[1];if(e&&this._term===i&&""!==i)return;this._term=i,this._search.apply(this,n)}else this._term=null,this.dropdown.deactivate()},fire:function(t){var e=Array.prototype.slice.call(arguments,1);return this.$el.trigger(t,e),this},register:function(t){Array.prototype.push.apply(this.strategies,t)},select:function(t,e,n){this._term=null,this.adapter.select(t,e,n),this.fire("change").fire("textComplete:select",t,e),this.adapter.focus()},_clearAtNext:!0,_term:null,_extractSearchQuery:function(e){for(var n=0;n<this.strategies.length;n++){var i=this.strategies[n],r=i.context(e);if(r||""===r){var o=t.isFunction(i.match)?i.match(e):i.match;s=r,"[object String]"===Object.prototype.toString.call(s)&&(e=r);var a=e.match(o);if(a)return[i,a[i.index],a]}}var s;return[]},_search:(e=function(t,e,n,i){var r=this;e.search(n,function(i,o){r.dropdown.shown||r.dropdown.activate(),r._clearAtNext&&(r.dropdown.clear(),r._clearAtNext=!1),r.dropdown.setPosition(r.adapter.getCaretPosition()),r.dropdown.render(r._zip(i,e,n)),o||(t(),r._clearAtNext=!0)},i)},function(){var t=Array.prototype.slice.call(arguments);if(n)i=t;else{n=!0;var r=this;t.unshift(function t(){if(i){var o=i;i=void 0,o.unshift(t),e.apply(r,o)}else n=!1}),e.apply(this,t)}}),_zip:function(e,n,i){return t.map(e,function(t){return{value:t,strategy:n,term:i}})}}),t.fn.textcomplete.Completer=a}),t("skylark-jquery-textcomplete/completer",function(){}),defin(["skylark-jquery","./textcomplete"],function(t){"use strict";function e(t,e,n){this.initialize(t,e,n)}t.extend(e.prototype,t.fn.textcomplete.Adapter.prototype,{select:function(e,n,i){var r=this.getTextFromHeadToCaret(),o=this.el.ownerDocument.getSelection(),a=o.getRangeAt(0),s=a.cloneRange();s.selectNodeContents(a.startContainer);var l,c=s.toString(),p=c.substring(a.startOffset),u=n.replace(e,i);if(void 0!==u){t.isArray(u)&&(p=u[1]+p,u=u[0]),l=t.isFunction(n.match)?n.match(r):n.match,r=r.replace(l,u).replace(/ $/,"&nbsp"),a.selectNodeContents(a.startContainer),a.deleteContents();var d=this.el.ownerDocument.createElement("div");d.innerHTML=r;var h=this.el.ownerDocument.createElement("div");h.innerHTML=p;for(var f,m,y=this.el.ownerDocument.createDocumentFragment();f=d.firstChild;)m=y.appendChild(f);for(;f=h.firstChild;)y.appendChild(f);a.insertNode(y),a.setStartAfter(m),a.collapse(!0),o.removeAllRanges(),o.addRange(a)}},_getCaretRelativePosition:function(){var e=this.el.ownerDocument.getSelection().getRangeAt(0).cloneRange(),n=e.endContainer.parentNode,i=this.el.ownerDocument.createElement("span");e.insertNode(i),e.selectNodeContents(i),e.deleteContents(),setTimeout(function(){n.normalize()},0);var r=t(i),o=r.offset();if(o.left-=this.$el.offset().left,o.top+=r.height()-this.$el.offset().top,o.lineHeight=r.height(),this.completer.$iframe){var a=this.completer.$iframe.offset();o.top+=a.top,o.left+=a.left,o.top-=t(this.completer.$iframe[0].contentWindow.document).scrollTop()}return r.remove(),o},getTextFromHeadToCaret:function(){var t=this.el.ownerDocument.getSelection().getRangeAt(0),e=t.cloneRange();return e.selectNodeContents(t.startContainer),e.toString().substring(0,t.startOffset)}}),t.fn.textcomplete.ContentEditable=e}),t("skylark-jquery-textcomplete/content_editable",function(){}),defin(["skylark-jquery","./textcomplete","./adapter","./vendor/textarea_caret"],function(t){"use strict";function e(t,e,n){this.initialize(t,e,n)}t.extend(e.prototype,t.fn.textcomplete.Adapter.prototype,{select:function(e,n,i){var r,o=this.getTextFromHeadToCaret(),a=this.el.value.substring(this.el.selectionEnd),s=n.replace(e,i);void 0!==s&&(t.isArray(s)&&(a=s[1]+a,s=s[0]),r=t.isFunction(n.match)?n.match(o):n.match,o=o.replace(r,s),this.$el.val(o+a),this.el.selectionStart=this.el.selectionEnd=o.length)},getTextFromHeadToCaret:function(){return this.el.value.substring(0,this.el.selectionEnd)},_getCaretRelativePosition:function(){var e=t.fn.textcomplete.getCaretCoordinates(this.el,this.el.selectionStart);return{top:e.top+this._calculateLineHeight()-this.$el.scrollTop(),left:e.left-this.$el.scrollLeft(),lineHeight:this._calculateLineHeight()}},_calculateLineHeight:function(){var t=parseInt(this.$el.css("line-height"),10);if(isNaN(t)){var e=this.el.parentNode,n=document.createElement(this.el.nodeName),i=this.el.style;n.setAttribute("style","margin:0px;padding:0px;font-family:"+i.fontFamily+";font-size:"+i.fontSize),n.innerHTML="test",e.appendChild(n),t=n.clientHeight,e.removeChild(n)}return t}}),t.fn.textcomplete.Textarea=e}),t("skylark-jquery-textcomplete/textarea",function(){}),t("skylark-jquery-textcomplete/main",["./textcomplete","./strategy","./completer","./content_editable","./textarea"],function(){}),t("skylark-jquery-textcomplete",["skylark-jquery-textcomplete/main"],function(t){return t})}(n),!r){var s=i("skylark-langx/skylark");o?module.exports=s:e.skylarkjs=s}}(0,this);
//# sourceMappingURL=sourcemaps/skylark-jquery-textcomplete.js.map
