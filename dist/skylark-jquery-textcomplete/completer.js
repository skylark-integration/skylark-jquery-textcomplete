/**
 * skylark-jquery-textcomplete - A version of jquery-textcomplete.js that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-jquery-textcomplete/
 * @license MIT
 */
define(["skylark-jquery","./textcomplete","./dropdown"],function(t){"use strict";var e,i,r,n=0,o=[];function a(e,i){if(this.$el=t(e),this.id="textcomplete"+n++,this.strategies=[],this.views=[],this.option=t.extend({},a.defaults,i),!(this.$el.is("input[type=text]")||this.$el.is("input[type=search]")||this.$el.is("textarea")||e.isContentEditable||"true"==e.contentEditable))throw new Error("textcomplete must be called on a Textarea or a ContentEditable.");if(e===e.ownerDocument.activeElement)this.initialize();else{var r=this;this.$el.one("focus."+this.id,function(){r.initialize()}),this.option.adapter&&"CKEditor"!=this.option.adapter||"undefined"==typeof CKEDITOR||!this.$el.is("textarea")||CKEDITOR.on("instanceReady",function(e){-1==t.inArray(e.editor.id,o)&&(o.push(e.editor.id),e.editor.on("focus",function(i){r.$el=t(e.editor.editable().$),r.option.adapter||(r.option.adapter=t.fn.textcomplete.CKEditor),r.option.ckeditor_instance=e.editor,r.initialize()}))})}}a.defaults={appendTo:"body",className:"",dropdownClassName:"dropdown-menu textcomplete-dropdown",maxCount:10,zIndex:"100",rightEdgeOffset:30},t.extend(a.prototype,{id:null,option:null,strategies:null,adapter:null,dropdown:null,$el:null,$iframe:null,initialize:function(){var e,i,r=this.$el.get(0);if(this.$el.prop("ownerDocument")!==document&&window.frames.length)for(var n=0;n<window.frames.length;n++)if(this.$el.prop("ownerDocument")===window.frames[n].document){this.$iframe=t(window.frames[n].frameElement);break}this.dropdown=new t.fn.textcomplete.Dropdown(r,this,this.option),this.option.adapter?e=this.option.adapter:(i=this.$el.is("textarea")||this.$el.is("input[type=text]")||this.$el.is("input[type=search]")?"number"==typeof r.selectionEnd?"Textarea":"IETextarea":"ContentEditable",e=t.fn.textcomplete[i]),this.adapter=new e(r,this,this.option)},destroy:function(){this.$el.off("."+this.id),this.adapter&&this.adapter.destroy(),this.dropdown&&this.dropdown.destroy(),this.$el=this.adapter=this.dropdown=null},deactivate:function(){this.dropdown&&this.dropdown.deactivate()},trigger:function(t,e){this.dropdown||this.initialize(),null!=t||(t=this.adapter.getTextFromHeadToCaret());var i=this._extractSearchQuery(t);if(i.length){var r=i[1];if(e&&this._term===r&&""!==r)return;this._term=r,this._search.apply(this,i)}else this._term=null,this.dropdown.deactivate()},fire:function(t){var e=Array.prototype.slice.call(arguments,1);return this.$el.trigger(t,e),this},register:function(t){Array.prototype.push.apply(this.strategies,t)},select:function(t,e,i){this._term=null,this.adapter.select(t,e,i),this.fire("change").fire("textComplete:select",t,e),this.adapter.focus()},_clearAtNext:!0,_term:null,_extractSearchQuery:function(e){for(var i=0;i<this.strategies.length;i++){var r=this.strategies[i],n=r.context(e);if(n||""===n){var o=t.isFunction(r.match)?r.match(e):r.match;s=n,"[object String]"===Object.prototype.toString.call(s)&&(e=n);var a=e.match(o);if(a)return[r,a[r.index],a]}}var s;return[]},_search:(e=function(t,e,i,r){var n=this;e.search(i,function(r,o){n.dropdown.shown||n.dropdown.activate(),n._clearAtNext&&(n.dropdown.clear(),n._clearAtNext=!1),n.dropdown.setPosition(n.adapter.getCaretPosition()),n.dropdown.render(n._zip(r,e,i)),o||(t(),n._clearAtNext=!0)},r)},function(){var t=Array.prototype.slice.call(arguments);if(i)r=t;else{i=!0;var n=this;t.unshift(function t(){if(r){var o=r;r=void 0,o.unshift(t),e.apply(n,o)}else i=!1}),e.apply(this,t)}}),_zip:function(e,i,r){return t.map(e,function(t){return{value:t,strategy:i,term:r}})}}),t.fn.textcomplete.Completer=a});
//# sourceMappingURL=sourcemaps/completer.js.map
