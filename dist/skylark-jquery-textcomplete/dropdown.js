/**
 * skylark-jquery-textcomplete - A version of jquery-textcomplete.js that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-jquery-textcomplete/
 * @license MIT
 */
defin(["skylark-jquery","./textcomplete"],function(t){"use strict";var e=t(window),i=function(t,e){var i,s,n=e.strategy.idProperty;for(i=0;i<t.length;i++)if((s=t[i]).strategy===e.strategy)if(n){if(s.value[n]===e.value[n])return!0}else if(s.value===e.value)return!0;return!1},s={};t(document).on("click",function(e){var i=e.originalEvent&&e.originalEvent.keepTextCompleteDropdown;t.each(s,function(t,e){t!==i&&e.deactivate()})});var n={SKIP_DEFAULT:0,KEY_UP:1,KEY_DOWN:2,KEY_ENTER:3,KEY_PAGEUP:4,KEY_PAGEDOWN:5,KEY_ESCAPE:6};function o(e,i,n){this.$el=o.createElement(n),this.completer=i,this.id=i.id+"dropdown",this._data=[],this.$inputEl=t(e),this.option=n,n.listPosition&&(this.setPosition=n.listPosition),n.height&&this.$el.height(n.height);var h=this;t.each(["maxCount","placement","footer","header","noResultsMessage","className"],function(t,e){null!=n[e]&&(h[e]=n[e])}),this._bindEvents(e),s[this.id]=this}t.extend(o,{createElement:function(e){var i=e.appendTo;return i instanceof t||(i=t(i)),t("<ul></ul>").addClass(e.dropdownClassName).attr("id","textcomplete-dropdown-"+e._oid).css({display:"none",left:0,position:"absolute",zIndex:e.zIndex}).appendTo(i)}}),t.extend(o.prototype,{$el:null,$inputEl:null,completer:null,footer:null,header:null,id:null,maxCount:null,placement:"",shown:!1,data:[],className:"",destroy:function(){this.deactivate(),this.$el.off("."+this.id),this.$inputEl.off("."+this.id),this.clear(),this.$el.remove(),this.$el=this.$inputEl=this.completer=null,delete s[this.id]},render:function(e){var i=this._buildContents(e),s=t.map(e,function(t){return t.value});if(e.length){var n=e[0].strategy;n.id?this.$el.attr("data-strategy",n.id):this.$el.removeAttr("data-strategy"),this._renderHeader(s),this._renderFooter(s),i&&(this._renderContents(i),this._fitToBottom(),this._fitToRight(),this._activateIndexedItem()),this._setScroll()}else this.noResultsMessage?this._renderNoResultsMessage(s):this.shown&&this.deactivate()},setPosition:function(i){var s="absolute";return this.$inputEl.add(this.$inputEl.parents()).each(function(){return"absolute"!==t(this).css("position")&&("fixed"===t(this).css("position")?(i.top-=e.scrollTop(),i.left-=e.scrollLeft(),s="fixed",!1):void 0)}),this.$el.css(this._applyPlacement(i)),this.$el.css({position:s}),this},clear:function(){this.$el.html(""),this.data=[],this._index=0,this._$header=this._$footer=this._$noResultsMessage=null},activate:function(){return this.shown||(this.clear(),this.$el.show(),this.className&&this.$el.addClass(this.className),this.completer.fire("textComplete:show"),this.shown=!0),this},deactivate:function(){return this.shown&&(this.$el.hide(),this.className&&this.$el.removeClass(this.className),this.completer.fire("textComplete:hide"),this.shown=!1),this},isUp:function(t){return 38===t.keyCode||t.ctrlKey&&80===t.keyCode},isDown:function(t){return 40===t.keyCode||t.ctrlKey&&78===t.keyCode},isEnter:function(t){return!(t.ctrlKey||t.altKey||t.metaKey||t.shiftKey)&&(13===t.keyCode||9===t.keyCode||!0===this.option.completeOnSpace&&32===t.keyCode)},isPageup:function(t){return 33===t.keyCode},isPagedown:function(t){return 34===t.keyCode},isEscape:function(t){return 27===t.keyCode},_data:null,_index:null,_$header:null,_$noResultsMessage:null,_$footer:null,_bindEvents:function(){this.$el.on("mousedown."+this.id,".textcomplete-item",t.proxy(this._onClick,this)),this.$el.on("touchstart."+this.id,".textcomplete-item",t.proxy(this._onClick,this)),this.$el.on("mouseover."+this.id,".textcomplete-item",t.proxy(this._onMouseover,this)),this.$inputEl.on("keydown."+this.id,t.proxy(this._onKeydown,this))},_onClick:function(e){var i=t(e.target);e.preventDefault(),e.originalEvent.keepTextCompleteDropdown=this.id,i.hasClass("textcomplete-item")||(i=i.closest(".textcomplete-item"));var s=this.data[parseInt(i.data("index"),10)];this.completer.select(s.value,s.strategy,e);var n=this;setTimeout(function(){n.deactivate(),"touchstart"===e.type&&n.$inputEl.focus()},0)},_onMouseover:function(e){var i=t(e.target);e.preventDefault(),i.hasClass("textcomplete-item")||(i=i.closest(".textcomplete-item")),this._index=parseInt(i.data("index"),10),this._activateIndexedItem()},_onKeydown:function(e){var i;if(this.shown)switch(t.isFunction(this.option.onKeydown)&&(i=this.option.onKeydown(e,n)),null==i&&(i=this._defaultKeydown(e)),i){case n.KEY_UP:e.preventDefault(),this._up();break;case n.KEY_DOWN:e.preventDefault(),this._down();break;case n.KEY_ENTER:e.preventDefault(),this._enter(e);break;case n.KEY_PAGEUP:e.preventDefault(),this._pageup();break;case n.KEY_PAGEDOWN:e.preventDefault(),this._pagedown();break;case n.KEY_ESCAPE:e.preventDefault(),this.deactivate()}},_defaultKeydown:function(t){return this.isUp(t)?n.KEY_UP:this.isDown(t)?n.KEY_DOWN:this.isEnter(t)?n.KEY_ENTER:this.isPageup(t)?n.KEY_PAGEUP:this.isPagedown(t)?n.KEY_PAGEDOWN:this.isEscape(t)?n.KEY_ESCAPE:void 0},_up:function(){0===this._index?this._index=this.data.length-1:this._index-=1,this._activateIndexedItem(),this._setScroll()},_down:function(){this._index===this.data.length-1?this._index=0:this._index+=1,this._activateIndexedItem(),this._setScroll()},_enter:function(t){var e=this.data[parseInt(this._getActiveElement().data("index"),10)];this.completer.select(e.value,e.strategy,t),this.deactivate()},_pageup:function(){var e=0,i=this._getActiveElement().position().top-this.$el.innerHeight();this.$el.children().each(function(s){if(t(this).position().top+t(this).outerHeight()>i)return e=s,!1}),this._index=e,this._activateIndexedItem(),this._setScroll()},_pagedown:function(){var e=this.data.length-1,i=this._getActiveElement().position().top+this.$el.innerHeight();this.$el.children().each(function(s){if(t(this).position().top>i)return e=s,!1}),this._index=e,this._activateIndexedItem(),this._setScroll()},_activateIndexedItem:function(){this.$el.find(".textcomplete-item.active").removeClass("active"),this._getActiveElement().addClass("active")},_getActiveElement:function(){return this.$el.children(".textcomplete-item:nth("+this._index+")")},_setScroll:function(){var t=this._getActiveElement(),e=t.position().top,i=t.outerHeight(),s=this.$el.innerHeight(),n=this.$el.scrollTop();0===this._index||this._index==this.data.length-1||e<0?this.$el.scrollTop(e+n):e+i>s&&this.$el.scrollTop(e+i+n-s)},_buildContents:function(t){var e,s,n,o="";for(s=0;s<t.length&&this.data.length!==this.maxCount;s++)e=t[s],i(this.data,e)||(n=this.data.length,this.data.push(e),o+='<li class="textcomplete-item" data-index="'+n+'"><a>',o+=e.strategy.template(e.value,e.term),o+="</a></li>");return o},_renderHeader:function(e){if(this.header){this._$header||(this._$header=t('<li class="textcomplete-header"></li>').prependTo(this.$el));var i=t.isFunction(this.header)?this.header(e):this.header;this._$header.html(i)}},_renderFooter:function(e){if(this.footer){this._$footer||(this._$footer=t('<li class="textcomplete-footer"></li>').appendTo(this.$el));var i=t.isFunction(this.footer)?this.footer(e):this.footer;this._$footer.html(i)}},_renderNoResultsMessage:function(e){if(this.noResultsMessage){this._$noResultsMessage||(this._$noResultsMessage=t('<li class="textcomplete-no-results-message"></li>').appendTo(this.$el));var i=t.isFunction(this.noResultsMessage)?this.noResultsMessage(e):this.noResultsMessage;this._$noResultsMessage.html(i)}},_renderContents:function(t){this._$footer?this._$footer.before(t):this.$el.append(t)},_fitToBottom:function(){var t=e.scrollTop()+e.height(),i=this.$el.height();this.$el.position().top+i>t&&(this.completer.$iframe||this.$el.offset({top:t-i}))},_fitToRight:function(){for(var t,i=this.option.rightEdgeOffset,s=this.$el.offset().left,n=this.$el.width(),o=e.width()-i;s+n>o&&(this.$el.offset({left:s-i}),!((t=this.$el.offset().left)>=s));)s=t},_applyPlacement:function(t){return-1!==this.placement.indexOf("top")?t={top:"auto",bottom:this.$el.parent().height()-t.top+t.lineHeight,left:t.left}:(t.bottom="auto",delete t.lineHeight),-1!==this.placement.indexOf("absleft")?t.left=0:-1!==this.placement.indexOf("absright")&&(t.right=0,t.left="auto"),t}}),t.fn.textcomplete.Dropdown=o,t.extend(t.fn.textcomplete,n)});
//# sourceMappingURL=sourcemaps/dropdown.js.map
