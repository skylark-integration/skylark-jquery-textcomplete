/**
 * skylark-jquery-textcomplete - A version of jquery-textcomplete.js that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-jquery-textcomplete/
 * @license MIT
 */
define(["skylark-jquery","./textcomplete","./adapter"],function(e){"use strict";function t(e,t,n){this.initialize(e,t,n)}e.extend(t.prototype,e.fn.textcomplete.Adapter.prototype,{select:function(t,n,o){var r=this.getTextFromHeadToCaret(),i=this.el.ownerDocument.getSelection(),a=i.getRangeAt(0),s=a.cloneRange();s.selectNodeContents(a.startContainer);var l,c=s.toString().substring(a.startOffset),f=n.replace(t,o);if(void 0!==f){e.isArray(f)&&(c=f[1]+c,f=f[0]),l=e.isFunction(n.match)?n.match(r):n.match,r=r.replace(l,f).replace(/ $/,"&nbsp"),a.selectNodeContents(a.startContainer),a.deleteContents();var m=this.el.ownerDocument.createElement("div");m.innerHTML=r;var d=this.el.ownerDocument.createElement("div");d.innerHTML=c;for(var p,h,g=this.el.ownerDocument.createDocumentFragment();p=m.firstChild;)h=g.appendChild(p);for(;p=d.firstChild;)g.appendChild(p);a.insertNode(g),a.setStartAfter(h),a.collapse(!0),i.removeAllRanges(),i.addRange(a)}},_getCaretRelativePosition:function(){var t=this.el.ownerDocument.getSelection().getRangeAt(0).cloneRange(),n=t.endContainer.parentNode,o=this.el.ownerDocument.createElement("span");t.insertNode(o),t.selectNodeContents(o),t.deleteContents(),setTimeout(function(){n.normalize()},0);var r=e(o),i=r.offset();if(i.left-=this.$el.offset().left,i.top+=r.height()-this.$el.offset().top,i.lineHeight=r.height(),this.completer.$iframe){var a=this.completer.$iframe.offset();i.top+=a.top,i.left+=a.left,i.top-=e(this.completer.$iframe[0].contentWindow.document).scrollTop()}return r.remove(),i},getTextFromHeadToCaret:function(){var e=this.el.ownerDocument.getSelection().getRangeAt(0),t=e.cloneRange();return t.selectNodeContents(e.startContainer),t.toString().substring(0,e.startOffset)}}),e.fn.textcomplete.ContentEditable=t});
//# sourceMappingURL=sourcemaps/content_editable.js.map
